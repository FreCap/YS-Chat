<html>
<p id="text">socket.io</p>
<head>
<script src="socket.io-6.0.js"></script> 
<script src="jquery-1.5.1.min.js"></script>
</head>

<script> 
    $(document).ready(function(){

		var Chat = function(start){
			var this2 = this;
		
			this.socket = new io.Socket("localhost", {
			  port: 9999,
			  transports: ['websocket','flashsocket', 'xhr-polling'],
			  rememberTransport: false
			});
		
			var actions = { CONNECT : 1, // { op:1 }
						LOGIN : 2, // { op:2, user:"String", pass:"String" }
						LOGINCHATKEY : 3, // { op:3, account_id:int, chat_key:"String" }
						CHG_STATUS : 4, // { op:4, status:int }
						DISCONNECT : 5, // { op:5 }
						CHAT_WITH : 6, // { op:6, account_id:int, message:"String" }
						CHAT_OPEN : 7, // { op:7, account_id:int }
						CHAT_CLOSE : 8, //  { op:8, account_id:int }
						LIST : 9 // { op:9 }
					}; 
			
			this.start = function(){
				this2.socket.connect();
			}
		
			this.startLogin = function(){
				message = { op: actions.CONNECT };
				this2.sendSocket(message);
			}
		
			// Add a connect listener
			this.socket.on('connect',function() {
			  console.log('Connesso!');
			  this2.startLogin();
			});
			// Add a connect listener
			this.socket.on('message',function(data) {
			  console.log('Received a message from the server!',data);
			 
			});
			// Add a disconnect listener
			this.socket.on('disconnect',function() {
			  console.log('The client has disconnected!');
			});

			this.sendSocket = function(data){
				console.log(JSON.stringify(message));
				this2.socket.send(JSON.stringify(message));
			}
			
			
			if(start == true){
				this.start();
			}
			
		}
	
		var a = new Chat(true);
		
	});
</script> 
